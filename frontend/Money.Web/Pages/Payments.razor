@page "/payments"
@attribute [Authorize]

<PageTitle>Операции</PageTitle>

@if (_init == false)
{
    <MudProgressLinear Indeterminate />
}

<MudTabs ApplyEffectsToContainer Elevation="4" Outlined PanelClass="px-6" Position="Position.Left" Rounded SliderAnimation>
    <MudTabPanel ID="1" Text="Список">
        <MudContainer Class="align-content-center" MaxWidth="MaxWidth.Large">
            <MudStack Class="mt-3" Spacing="2">
                <MudItem>
                    <MudStack AlignItems="AlignItems.Stretch" Spacing="3">

                        <MudDateRangePicker AdornmentColor="Color.Tertiary"
                                            AnchorOrigin="Origin.BottomLeft"
                                            @bind-DateRange="@FilterDateRange" Clearable
                                            Color="Color.Tertiary"
                                            Label="Диапазон дат"
                                            PickerVariant="PickerVariant.Inline" Rounded />

                        <MudSelect AdornmentColor="Color.Tertiary"
                                   AdornmentIcon="@Icons.Material.Rounded.Search"
                                   AnchorOrigin="Origin.BottomCenter"
                                   @bind-SelectedValues="FilterCategories"
                                   Label="Категории" MultiSelection
                                   ToStringFunc="@(arg => arg?.Name)">
                            @foreach (Category category in Categories ?? [])
                            {
                                <MudSelectItem Value="@category">
                                    @category.Name
                                </MudSelectItem>
                            }
                        </MudSelect>

                        <MudTextField @bind-Value="FilterPlace"
                                      Label="Место" />

                        <MudTextField @bind-Value="FilterComment"
                                      Label="Комментарий" />
                    </MudStack>
                </MudItem>
                <MudItem>
                    <PaymentDialog @ref="_dialog"
                                   Payment="@(new Payment { Date = DateTime.Now, Category = Category.Empty })"
                                   OnSubmit="AddNewPayment">
                        <MudStack AlignItems="AlignItems.Start" Row>
                            @foreach (PaymentTypes.Value type in PaymentTypes.Values)
                            {
                                <MudTooltip Text="@type.AddText">
                                    <MudButton Color="type.Color"
                                               Disabled="_dialog.IsOpen"
                                               OnClick="() => _dialog.ToggleOpen(type)"
                                               Size="Size.Small"
                                               Variant="Variant.Filled"
                                               EndIcon="@type.Icon">
                                        @type.AddText
                                    </MudButton>
                                </MudTooltip>
                            }
                            <MudTooltip Text="Быстрое добавление">
                                <MudButton Color="Color.Info"
                                           Disabled="_dialog.IsOpen"
                                           OnClick="() => _dialog.ToggleOpen()"
                                           Size="Size.Small"
                                           Variant="Variant.Filled">
                                    Быстрое добавление
                                </MudButton>
                            </MudTooltip>
                            <MudSpacer />
                            <MudTooltip Text="Найти">
                                <MudButton Color="Color.Info"
                                           EndIcon="@Icons.Material.Rounded.Search"
                                           OnClick="Search"
                                           Size="Size.Small"
                                           Variant="Variant.Filled">
                                    Найти
                                </MudButton>
                            </MudTooltip>
                        </MudStack>
                    </PaymentDialog>
                </MudItem>
                @foreach (PaymentsDay paymentsDay in PaymentsDays ?? [])
                {
                    <PaymentsDayCard PaymentsDay="@paymentsDay"
                                     PaymentTypes="@PaymentTypes.Values"
                                     OnAddPayment="x => paymentsDay.Payments.Add(x)"
                                     OnRestore="Restore"
                                     OnDelete="Delete" />
                }
            </MudStack>
        </MudContainer>
    </MudTabPanel>
    <MudTabPanel Text="Регулярные" ID="2">
        =)
    </MudTabPanel>
    <MudTabPanel Text="Быстрые" ID="3">
        =)
    </MudTabPanel>
</MudTabs>
