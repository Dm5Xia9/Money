@page "/payments-new"
@attribute [Authorize]

<PageTitle>Операции</PageTitle>

<MudText GutterBottom Typo="Typo.h3">Операции</MudText>

@if (_init == false)
{
    <MudStack AlignItems="AlignItems.Center" Row>
        <MudProgressCircular Indeterminate />
        <MudText Typo="Typo.body1">Загрузка..</MudText>
    </MudStack>

    return;
}

<MudTabs Elevation="4" Outlined>
    <MudTabPanel ID="1" Text="Список операций">
        <MudStack Class="mt-3" Spacing="3">
            @foreach (PaymentsDay paymentsDay in PaymentsDays)
            {
                <MudCard Elevation="3">
                    <MudCardHeader Class="border-b-4 border-solid mud-border-tertiary">
                        <CardHeaderContent>
                            <MudStack AlignItems="AlignItems.Center" Justify="Justify.FlexStart" Row>
                                <MudItem xs="2">
                                    <MudStack Justify="Justify.FlexStart" Row StretchItems="StretchItems.End">
                                        <MudIcon Icon="@Icons.Material.Rounded.CalendarToday" Size="Size.Small" />
                                        <MudText>
                                            @paymentsDay.Date.ToShortDateString()
                                        </MudText>
                                    </MudStack>
                                </MudItem>
                                @foreach (PaymentTypes.Value paymentType in PaymentTypes.Values)
                                {
                                    <MudItem xs="2">
                                        <MudStack AlignItems="AlignItems.Center" Justify="Justify.FlexEnd" Row StretchItems="StretchItems.End">
                                            <MudIcon Color="@paymentType.Color" Icon="@paymentType.Icon" Size="Size.Small" />
                                            <MudText>
                                                @paymentsDay.Payments.Where(x => x.Category.PaymentTypeId == paymentType.Id).Sum(x => x.Sum)
                                            </MudText>
                                        </MudStack>
                                    </MudItem>
                                }
                            </MudStack>
                            <MudSpacer />
                        </CardHeaderContent>
                        <CardHeaderActions>
                            <MudStack AlignItems="AlignItems.Center" Row>
                                <MudIconButton Color="Color.Warning" Icon="@Icons.Material.Rounded.Add" Title="Добавить расходы" />
                                <MudIconButton Color="Color.Success" Icon="@Icons.Material.Rounded.Add" Title="Добавить доходы" />
                                <MudIconButton Color="Color.Info" Icon="@Icons.Material.Rounded.Add" Title="Быстрое добавление" />
                            </MudStack>
                        </CardHeaderActions>
                    </MudCardHeader>
                    <MudCardContent>
                        <MudStack StretchItems="StretchItems.All">
                            @foreach (Payment payment in paymentsDay.Payments)
                            {
                                <MudStack AlignItems="AlignItems.Center" Justify="Justify.FlexStart" Row>
                                    <MudIcon Color="@payment.Category.PaymentType.Color" Icon="@payment.Category.PaymentType.Icon" Size="Size.Small" />
                                    <MudIconButton Icon="@Icons.Material.Rounded.ModeEdit" OnClick="() => EditPayment2(payment.Id)" Size="Size.Small" Title="Редактировать" />
                                    <MudItem xs="1">
                                        <MudText Align="Align.Left" Inline>@payment.Sum</MudText>
                                    </MudItem>
                                    <MudItem xs="3">
                                        <MudText Align="Align.Left" Inline title="@payment.Category.Name">@payment.Category.Name</MudText>
                                    </MudItem>
                                    <MudItem xs="3">
                                        <MudText Align="Align.Left" Inline title="@payment.Place">@payment.Place</MudText>
                                    </MudItem>
                                    @if (payment.CreatedTaskId != null)
                                    {
                                        <MudItem xs="1">
                                            <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Title="Создано регулярной задачей" />
                                        </MudItem>
                                    }
                                    <MudItem xs="4">
                                        <MudText Align="Align.Left" Inline Typo="Typo.body2">@payment.Comment</MudText>
                                    </MudItem>
                                    <MudSpacer />
                                    <MudIconButton Icon="@Icons.Material.Filled.Delete" OnClick="() => DeletePayment(payment.Id)" Size="Size.Small" Title="Удалить" />
                                </MudStack>
                            }
                        </MudStack>
                    </MudCardContent>
                </MudCard>

                // Если верхняя версия слишком крупная, ниже попытка её максимально сжать

                @*<MudCard>
                    <MudCardHeader Class="border-b-2 border-solid mb-n2 mud-border-tertiary pb-n2">
                        <CardHeaderContent>
                            <MudStack AlignItems="AlignItems.Center" Justify="Justify.FlexStart" Row>
                                <MudItem xs="2">
                                    <MudStack Justify="Justify.FlexStart" Row StretchItems="StretchItems.End">
                                        <MudIcon Icon="@Icons.Material.Rounded.CalendarToday" Size="Size.Small" />
                                        <MudText>
                                            @paymentsDay.Date.ToShortDateString()
                                        </MudText>
                                    </MudStack>
                                </MudItem>
                                @foreach (PaymentTypes.Value paymentType in PaymentTypes.Values)
                                {
                                    <MudItem xs="2">
                                        <MudStack AlignItems="AlignItems.Center" Justify="Justify.FlexEnd" Row StretchItems="StretchItems.End">
                                            <MudIcon Color="@paymentType.Color" Icon="@paymentType.Icon" Size="Size.Small" />
                                            <MudText>
                                                @paymentsDay.Payments.Where(x => x.Category.PaymentTypeId == paymentType.Id).Sum(x => x.Sum)
                                            </MudText>
                                        </MudStack>
                                    </MudItem>
                                }
                            </MudStack>
                            <MudSpacer />
                        </CardHeaderContent>
                        <CardHeaderActions>
                            <MudStack AlignItems="AlignItems.Center" Row>
                                <MudIconButton Color="Color.Warning" Icon="@Icons.Material.Rounded.Add" Size="Size.Small" Title="Добавить расходы" />
                                <MudIconButton Color="Color.Success" Icon="@Icons.Material.Rounded.Add" Size="Size.Small" Title="Добавить доходы" />
                                <MudIconButton Color="Color.Info" Icon="@Icons.Material.Rounded.Add" Size="Size.Small" Title="Быстрое добавление" />
                            </MudStack>
                        </CardHeaderActions>
                    </MudCardHeader>
                    <MudCardContent Class="my-n2 py-n2">
                        <MudStack StretchItems="StretchItems.All">
                            @foreach (Payment payment in paymentsDay.Payments)
                            {
                                <MudStack AlignItems="AlignItems.Center" Justify="Justify.FlexStart" Row>
                                    <MudIcon Class="mx-n2" Color="@payment.Category.PaymentType.Color" Icon="@payment.Category.PaymentType.Icon" Size="Size.Small" />
                                    <MudIconButton Class="mr-n2" Icon="@Icons.Material.Rounded.ModeEdit" OnClick="() => EditPayment2(payment.Id)" Size="Size.Small" Title="Редактировать" />
                                    <MudItem xs="1">
                                        <MudText Align="Align.Left" Inline>@payment.Sum</MudText>
                                    </MudItem>
                                    <MudItem xs="3">
                                        <MudText Align="Align.Left" Inline title="@payment.Category.Name">@payment.Category.Name</MudText>
                                    </MudItem>
                                    <MudItem xs="3">
                                        <MudText Align="Align.Left" Inline title="@payment.Place">@payment.Place</MudText>
                                    </MudItem>
                                    @if (payment.CreatedTaskId != null)
                                    {
                                        <MudItem xs="1">
                                            <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Title="Создано регулярной задачей" />
                                        </MudItem>
                                    }
                                    <MudItem xs="4">
                                        <MudText Align="Align.Left" Inline Typo="Typo.body2">@payment.Comment</MudText>
                                    </MudItem>
                                    <MudSpacer />
                                    <MudIconButton Class="mr-n2" Icon="@Icons.Material.Filled.Delete" OnClick="() => DeletePayment(payment.Id)" Size="Size.Small" Title="Удалить" />
                                </MudStack>
                            }
                        </MudStack>
                    </MudCardContent>
                </MudCard>*@
            }
        </MudStack>
    </MudTabPanel>
    <MudTabPanel Text="Регулярные операции" ID="2">
        =)
    </MudTabPanel>
    <MudTabPanel Text="Быстрые операции" ID="3">
        =)
    </MudTabPanel>
</MudTabs>
