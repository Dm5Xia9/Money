@page "/categories"
@attribute [Authorize]

<PageTitle>Категории</PageTitle>

<MudText GutterBottom Typo="Typo.h3">Категории</MudText>

@if (_init == false)
{
    <MudStack AlignItems="AlignItems.Center" Row>
        <MudProgressCircular Indeterminate />
        <MudText Typo="Typo.body1">Загрузка..</MudText>
    </MudStack>

    return;
}

<MudTabs Elevation="4" Color="@Color.Primary">
    @foreach (PaymentTypes.Value paymentType in PaymentTypes.Values)
    {
        <MudTabPanel Text="@paymentType.Name">
            <MudButton OnClick="() => Create(paymentType)"
                       Size="Size.Large"
                       Variant="Variant.Outlined">
                Создать
            </MudButton>
            <MudTreeView ExpandOnClick Hover Items="@InitialTreeItems[paymentType.Id]" ReadOnly Ripple>
                <ItemTemplate>
                    @{
                        Category? category = context.Value;
                    }
                    <MudTreeViewItem @bind-Expanded="@context.Expanded" Items="@context.Children" Value="@context.Value">
                        <Content>
                            <MudTreeViewItemToggleButton @bind-Expanded="@context.Expanded" Visible="@context.HasChildren" />
                            <MudText>@category?.Name</MudText>
                            @if (category?.Color is not null)
                            {
                                <MudChip Class="ml-1">@category.Color</MudChip>
                            }
                        </Content>
                    </MudTreeViewItem>
                </ItemTemplate>
            </MudTreeView>
        </MudTabPanel>
    }
</MudTabs>
