@page "/payments"
@attribute [Authorize]

<PageTitle>Операции</PageTitle>

@if (_init == false)
{
    <MudProgressLinear Indeterminate />
}

<MudStack Class="mt-3"
          Spacing="2">
    <MudItem>
        <PaymentsFilter @ref="_filter" />
    </MudItem>
    <MudItem>
        <PaymentDialog OnSubmit="AddNewPayment"
                       Payment="@(new Payment { Date = DateTime.Now, Category = Category.Empty })"
                       @ref="_dialog">
            <MudStack AlignItems="AlignItems.Start"
                      Row>
                @foreach (PaymentTypes.Value type in PaymentTypes.Values)
                {
                    <MudTooltip Text="@type.AddText">
                        <MudButton Color="type.Color"
                                   Disabled="_dialog.IsOpen"
                                   EndIcon="@type.Icon"
                                   OnClick="() => _dialog.ToggleOpen(type)"
                                   Size="Size.Small"
                                   Variant="Variant.Filled">
                            @type.AddText
                        </MudButton>
                    </MudTooltip>
                }
                <MudTooltip Text="Быстрое добавление">
                    <MudButton Color="Color.Info"
                               Disabled="_dialog.IsOpen"
                               OnClick="() => _dialog.ToggleOpen()"
                               Size="Size.Small"
                               Variant="Variant.Filled">
                        Быстрое добавление
                    </MudButton>
                </MudTooltip>
                <MudSpacer />
                <MudTooltip Text="Найти">
                    <MudButton Color="Color.Info"
                               EndIcon="@Icons.Material.Rounded.Search"
                               OnClick="Search"
                               Size="Size.Small"
                               Variant="Variant.Filled">
                        Найти
                    </MudButton>
                </MudTooltip>
            </MudStack>
        </PaymentDialog>
    </MudItem>
    @foreach (PaymentsDay paymentsDay in PaymentsDays ?? [])
    {
        <PaymentsDayCard OnAddPayment="x => AddPayment(x, paymentsDay)"
                         OnCanDelete="DeleteDay"
                         OnDelete="Delete"
                         OnRestore="Restore"
                         PaymentsDay="@paymentsDay"
                         PaymentTypes="@PaymentTypes.Values" />
    }
</MudStack>
